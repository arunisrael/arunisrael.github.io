<div dir="ltr" style="text-align: left;" trbidi="on">
<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">Before getting into how to access external APIs with angular.js, let's cover some background material.<br /><br /><b>XHR (XMLHttpRequest)</b><br />This is an API available in JavaScript that allows for the sending and retrieval of http/https requests and responses to/from a server.&nbsp; The response data can be used to alter the current document without reloading the page. It is typically used to transfer JSON payloads.<br /><br /><b>Same Origin Policy</b></span><br />
<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">A policy implemented by browsers that prevents access to scripts outside the current domain. XHR is subject to this policy, &lt;script&gt; tags are not. This policy means that scripts on mysite.com can not make XHR requests for data from yoursite.com-- there are workarounds to this (JSONP, CORS, cross domain messaging, modifying document.domain property)<br /><br /><b>JSONP</b><br />JSON with padding (or prefix) where the padding or prefix is a function call that wraps the response data. JSONP is a way to get data from a server in a different domain. By modifying the URL of the request to include '?jsonp=callBackFn' or '?callback=callBackFn' that notifies the responding server to wrap the response in the function named callBackFn.&nbsp; The end result is that callBackFn(response_data) will be invoked in the context of the requesting script. Without JSONP, you would just receive back the raw data. With JSONP, you can receive back arbitrary javascript (though it typically tends to be JSON) that will be evaluated in the callback function you provide.<br /><b><br />CORS (Cross Origin Resource Sharing)</b><br />A mechanism allowing JavaScript on one site to make XHR requests to another domain. This is enabled through the use of special HTTP headers. This allows a script on mysite.com to make XHR requests to yoursite.com provided that yoursite.com returns the proper HTTP headers. Specifically, yoursite.com would need to respond with "Access-Control-Allow-Origin: $value" where $value could either be '*' or 'mysite.com'</span><br />
<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">CORS supports all HTTP methods unlike JSONP which only supports GET.<br /><br /><b>Preflighting</b><br />A mechanism utilized in CORS whereby an initial "pre-flight" request is made to the server to determine if the appropriate permissions are available before making the real request. A preflight request is an 'OPTIONS' HTTP request that the server can respond to by specifying the allowed methods and origin. If the server responds appropriately, the browser sends the real request<br /><br />The plunker code snippets below attempt to retrieve some data from various external APIs and display the data through the $scope's data property. Hit the play icon in the top right of each plunker to see the result. <br /><br /><b>$http.get on an API that does not support CORS</b> <br />This first plunker below shows a naive get of the OpenWeatherMap API using $http.get</span><br />
<iframe frameborder="0" src="http://embed.plnkr.co/I4n89Ac3Rlsfa3POw23c/app.js" style="height: 250px; width: 100%;"></iframe><span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">Clearly, this did not work. Looking at the console, you can see the following error messages. </span><br />
<br />
<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><a href="http://2.bp.blogspot.com/-b0wz4WhL8QE/Ufq09hainHI/AAAAAAAAGYA/_vbKRzXb010/s1600/Screen+Shot+2013-08-01+at+3.19.31+PM.png" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-b0wz4WhL8QE/Ufq09hainHI/AAAAAAAAGYA/_vbKRzXb010/s640/Screen+Shot+2013-08-01+at+3.19.31+PM.png" height="17" width="640" /></a><br /><span style="font-size: x-small;"><span style="font-size: small;"></span></span></span><br />
<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><span style="font-size: x-small;"><span style="font-size: small;"><br />You can run the curl cmd below to reveal the headers for this request</span> </span></span><br />
<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><span style="font-size: x-small;">&gt;&gt; curl -X OPTIONS -i 'http://api.openweathermap.org/data/2.5/weather?lat=35&amp;lon=139' -H "Origin: http://example.com"<br /><br /><span style="font-size: small;">Notice that there is no "Access-Control-Allow-Origin" header.</span><br />HTTP/1.1 200 OK<br />Content-Type: application/json; charset=utf-8<br />Date: Thu, 01 Aug 2013 19:22:36 GMT<br />Server: nginx<br />X-Powered-By: OWM<br />Content-Length: 422<br />Connection: keep-alive</span><br />This means that the OpenWeatherMap API does support CORS. We can try to access the API via JSONP.</span><br />
<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><b>$http.jsonp on an API that does not support CORS, but supports JSONP</b></span><br />The plunker below shows the retrieval of OpenWeatherMap data using $http.jsonp </span><br />
<iframe frameborder="0" src="http://embed.plnkr.co/VlDQZTvlxT0favuq0MeG/app.js" style="height: 250px; width: 100%;"></iframe>
<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><br /><br />Success! We are able to retrieve OpenWeatherMap API data using JSONP.<br /><br /><b>$http.get of an API that supports CORS</b><br />The plunker below shows the retrieval of github api data using http.get </span><br />
<iframe frameborder="0" src="http://embed.plnkr.co/9an0Zhap2BYpnITThmMc/app.js" style="height: 250px; width: 100%;"></iframe>

<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><br />Success! Running curl on the github API will show the CORS related headers.</span><br />
<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><br /><span style="font-size: x-small;">&gt;&gt; curl -X OPTIONS -i https://api.github.com -H "Origin: http://example.com"<br /><br />HTTP/1.1 204 No Content<br />Server: GitHub.com<br />Date: Thu, 01 Aug 2013 19:29:16 GMT<br />Status: 204 No Content<br /><span style="color: #38761d;">Access-Control-Allow-Credentials: true<br />Access-Control-Expose-Headers: ETag, Link, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes<br />Access-Control-Max-Age: 86400<br />Access-Control-Allow-Headers: Authorization, Content-Type, If-Match, If-Modified-Since, If-None-Match, If-Unmodified-Since, X-Requested-With<br />Access-Control-Allow-Methods: GET, POST, PATCH, PUT, DELETE<br />Access-Control-Allow-Origin: *</span>Vary: Accept-Encoding</span><br /><b>APIs that do not support preflight requests</b><br />Finally, lets look at the Spotify API which does not respond appropriately to the preflight OPTIONS request.<br /><br />The plunker below shows the retrieval of spotify api data using http.get in angular 1.0</span><br />
<iframe frameborder="0" src="http://embed.plnkr.co/aW03SccQlymn0LDJxWAi/app.js" style="height: 250px; width: 100%;"></iframe>

<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><br />This does not work as the preflight request is rejected by the server.<br /><br /><span style="font-size: x-small;">curl -X OPTIONS -i 'http://ws.spotify.com/search/1/artist.json?q=bah' -H "Origin: http://example.com"<br /><br />HTTP/1.1 400 Bad Request<br />Server: nginx<br />Date: Thu, 01 Aug 2013 19:39:34 GMT<br />Content-Type: text/html<br />Content-Length: 134<br />Connection: keep-alive<br />Keep-Alive: timeout=10</span><br /><br />$http requests in Angular 1.0.x include the 'X-Requested-With' header which triggers the preflight request in CORS. The plunker below removes this header.</span><br />
<iframe frameborder="0" src="http://embed.plnkr.co/DlyuOpzD381HDKGcbuph/app.js" style="height: 250px; width: 100%;"></iframe>

<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><br /></span><br />
<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><br />Success! We are now able to retrieve data from the Spotify API.<br /> </span><br />
<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">The 'X-Requested-With' header has been removed in Angular 1.1.x<br />The plunker below shows the retrieval of Spotify API data using $http.get in angular 1.1 </span><br />
<iframe frameborder="0" src="http://embed.plnkr.co/MF5STy95afdNZyddGyao/app.js" style="height: 250px; width: 100%;"></iframe>

<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><br /><br /><b>Summary</b><br />Use curl -X OPTIONS -i $api_endpoint -H "http://example.com" to see if $api_endpoint supports preflight requests. If not and you are using angular 1.0.x, remove the 'X-Requested-With' header from the $httpProvider<br /><br />Use curl -i $api_endpoint?callback=callBackFn -H "http://example.com" to see if $api_endpoint supports JSONP</span><br />
<span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">Not covered here, but angular also provides $resource which can be used to interact with RESTful API services.</span></div>

